# lib

ディレクトリ構成
```
lib
- common.sh
- logger.sh
- query.sh
- setup_nspawn.sh
- container
    - create_base_rootfs.sh
    - create_container.sh
    - list_container.sh
    - remove_container.sh
    - run_container.sh
    - stop_container.sh
- vnet
    - bridge.sh
    - netns.sh
    - network.sh
    - veth.sh
```


関数マップ
```
lib
- common.sh
    - load_logger
        -> lib/logger.sh
    - load_query
        -> lib/query.sh
    - check_root
- logger.sh
    - rotate_log
    - log
        -> rotate_log
- query.sh
    -> lib/logger.sh
    - get_bridge_info
    - list_bridges
    - get_bridge_ports
    - get_veth_info
    - get_netns_interfaces
- setup_nspawn.sh
    -> lib/common.sh
        -> load_logger
        -> check_root
    - install_packages
    - install_base
        -> install_packages
    - install_utils
        -> install_packages
    - install_yq

- container
    - create_base_rootfs.sh
        -> lib/common.sh
            -> load_logger
            -> check_root
        - cleanup
    - create_container.sh
        -> lib/common.sh
            -> load_logger
            -> check_root
    - remove_container.sh
        -> lib/common.sh
            -> load_logger
            -> check_root
    - list_container.sh
        -> lib/common.sh
            -> load_logger
    - run_container.sh
        -> lib/common.sh
            -> load_logger
            -> check_root
        - cleanup
            -> stop_container.sh
        - create_netns
        - run_container
    - stop_container.sh
        - init
            -> lib/common.sh
                -> load_logger
                -> check_root
        - is_running
        - is_exists
        - stop_container
        - cleanup
        - main
            -> init
            -> is_running
            -> stop_container
            -> cleanup

- vnet
    - bridge.sh
        -> lib/logger.sh
        -> lib/query.sh
        - create_bridge
            -> bridge_exists
        - delete_bridge
            -> bridge_exists
        - bridge_exists
        - bridge_up
        - bridge_down
    - netns.sh
        -> lib/common.sh
            -> load_logger
            -> check_root
        - create_netns
            -> netns_exists
        - netns_exists
            -> netns_exists
        - remove_netns
    - network.sh
        -> lib/logger.sh
        -> lib/query.sh
        - assign_ip_address
        - setup_routing
    - veth.sh
        -> lib/logger.sh
        -> lib/query.sh
        - init
            -> load_logger
            -> check_root
        - create_veth
        - delete_veth
        - attach_veth
        - detach_veth
        - list_veth
        - veth_info
        - main
            -> init
```


## 案

nspawnコンテナ管理スクリプトの関数名を提案します。以下のようにカテゴリ別に関数名を整理しました：

## 基本操作関数
- `container_start()`
- `container_stop()`
- `container_restart()`
- `container_status()`
- `container_list()`
- `container_shell()`

## コンテナ作成/設定関連
- `container_create()`
- `container_remove()`
- `container_clone()`
- `container_configure()`
- `container_setup_network()`
- `container_mount()`
- `container_unmount()`
- `container_cleanup()`

## イメージ管理
- `image_create()`
- `image_import()`
- `image_export()`
- `image_remove()`
- `image_list()`

## ネットワーク関連
- `create_bridge()`
- `remove_bridge()`
- `setup_veth()`
- `setup_macvlan()`
- `setup_ipvlan()`
- `network_attach()`
- `network_detach()`

## 状態チェック関数
- `container_exists()`
- `container_is_running()`
- `container_is_stopped()`
- `network_namespace_exists()`

## ユーティリティ関数
- `container_backup()`
- `container_restore()`
- `container_migrate()`

